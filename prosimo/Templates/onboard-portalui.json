{
  "$schema": "<relative path to createFormUI.schema.json>",
  "view": {
      "kind": "Form",
      "properties": {
          "title": "Prosimo Subscription Onboarding",
          "steps": [
              {
                  "name": "basics",
                  "label": "Management Group Susbcriptions to Onboard",
                  "elements": [
                      {
                          "name": "introText",
                          "type": "Microsoft.Common.InfoBox",
                          "visible": true,
                          "options": {
                            "icon": "Info",
                            "text": "This will provision an Azure Deployment Script to make REST calls to your Prosimo SaaS platform. The management group selected will be scanned, and all subscriptions contained within the hierarchy will be added as accounts in your PRosimo dashboard. These accounts may be used to onboard applications into the Prosimo Platform."
                          }
                        },
                        {
                          "name": "resourceScope",
                          "type": "Microsoft.Common.ResourceScope"
                      }         
                  ]
              },
              {
                "name": "azureStep",
                "label": "Azure Setup",
                "elements": [
                  {
                    "name": "introText",
                    "type": "Microsoft.Common.InfoBox",
                    "visible": true,
                    "options": {
                      "icon": "Info",
                      "text": "Select a subscription to store the deployment script. This script will run against the Prosimo REST API to onboard your selected Azure susbcriptions."
                    }
                  },
                  {
                    "name": "deploymentDetails",
                    "label": "Prosimo Deployment Script",
                    "type": "Microsoft.Common.Section",
                    "visible": true,
                    "elements": [
                      {
                        "name": "subscriptionApi",
                        "type": "Microsoft.Solutions.ArmApiControl",
                        "request": {
                            "method": "GET",
                            "path": "subscriptions?api-version=2020-01-01"
                        }
                    },
                    {
                      "name": "subscriptionId",
                      "label": "Subscription",
                      "type": "Microsoft.Common.DropDown",
                      "visible": true,
                      "defaultValue": "",
                      "toolTip": "Select the Subscription for the Prosimo deployment script.",
                      "multiselect": false,
                      "selectAll": false,
                      "filter": true,
                      "filterPlaceholder": "Filter items ...",
                      "multiLine": true,
                      "constraints": {
                          "allowedValues": "[map(steps('AzureStep').deploymentDetails.subscriptionApi.value, (item) => parse(concat('{\"label\":\"', item.displayName, '\",\"value\":\"', item.id, '\",\"description\":\"', 'ID: ', item.subscriptionId, '\"}')))]",
                          "required": true
                      }
                  },  
                      {
                        "name": "clientId",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Service Principal Client ID",
                        "defaultValue": "",
                        "toolTip": "Service Principal Client ID",
                        "placeholder": "",
                        "multiLine": false,
                        "constraints": {
                          "required": true,
                          "validations": []
                        },
                        "visible": true
                      },
                      {
                        "name": "clientSecret",
                        "type": "Microsoft.Common.PasswordBox",
                        "label": {
                          "password": "Service Principal Secret"
                        },
                        "toolTip": "",
                        "constraints": {
                          "required": true
                        },
                        "options": {
                          "hideConfirmation": true
                        },
                        "visible": true
                      }
                    ]
                }                  
                ]

              },
              {
                "name": "prosimoStep",
                "label": "Prosimo Setup",
                "elements": [
                  {
                    "name": "prosimoSubs",
                    "type": "Microsoft.Common.ResourceScope"
                },
                  {
                    "name": "prosimoTeamName",
                    "type": "Microsoft.Common.TextBox",
                    "label": "Prosimo Team Name",
                    "defaultValue": "",
                    "toolTip": "Enter the name of your Prosimo Team. You will have created this on your initial login.",
                    "placeholder": "",
                    "multiLine": false,
                    "constraints": {
                      "required": true,
                      "validations": []
                    },
                    "visible": true
                  },
                  {
                    "name": "prosimoApiToken",
                    "type": "Microsoft.Common.PasswordBox",
                    "label": {
                      "password": "Prosimo API Token"
                    },
                    "toolTip": "",
                    "constraints": {
                      "required": true
                    },
                    "options": {
                      "hideConfirmation": true
                    },
                    "visible": true
                  }
                ]
              }
          ]
      },
      "outputs": {
          "kind": "ManagementGroup",
          "location": "[steps('basics').resourceScope.location.name]",
          "managementGroupId": "[steps('basics').resourceScope.managementGroup.id]",
          "parameters": {
              "managementGroupName": "[steps('basics').resourceScope.managementGroup.name]",
              "subscriptionId": "[steps('azureStep').deploymentDetails.subscriptionId]",
              "prosimoTeamName": "[steps('prosimoStep').prosimoTeamName]",
              "prosimoApiToken": "[steps('prosimoStep').prosimoApiToken]",
              "clientId": "[steps('azureStep').deploymentDetails.clientId]",
              "clientSecret": "[steps('azureStep').deploymentDetails.clientSecret]"
          }
      }        
  }
}